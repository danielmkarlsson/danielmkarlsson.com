!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.DMKPlayer=e():t.DMKPlayer=e()}(self,()=>(()=>{"use strict";var i={d:(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},t={};i.d(t,{default:()=>e});const c='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M3 22V2l18 10L3 22z"/></svg>',n='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M10 24H4V0h6v24zM20 0h-6v24h6V0z"/></svg>';const e=class{constructor(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(this.options=Object.assign({},{isVideo:!1,advanceToNextTrack:!0},e),this.options.layout=Object.assign({},{title:!0,elapsedTime:!0},s),void 0===this.options.playlist)throw new Error("No playlist found.");if(void 0===this.options.rootUrl)throw new Error("No root URL supplied.");if(void 0===this.options.playlistIndexUrl)throw new Error("No playlist index URL supplied.");"/"!=this.options.rootUrl.charAt(this.options.rootUrl.length-1)&&(this.options.rootUrl=this.options.rootUrl+"/"),"/"!=this.options.playlistIndexUrl.charAt(this.options.playlistIndexUrl.length-1)&&(this.options.playlistIndexUrl=this.options.playlistIndexUrl+"/"),this.lastId=null,this.fileIndex=null,this.currentTrack=null,this.playerCurrentTime=void 0,this.trackList=[],this.trackListLength=0,this.mediaTag=document.createElement(this.options.isVideo?"video":"audio"),this.addClassName(this.mediaTag,"dmk-media-tag"),this.mediaTag.addEventListener("ended",this.onPlayerEnded.bind(this),!1),this.components={},this.components.root=t,this.callbacks={},this.isPlaying=!1,this.buildPlayer(),this.init(this.options.playlist,this.options.playlistIndexUrl)}addClassName(t,e){t.classList.add(e)}on(t,e){this.callbacks[t]=e}buildPlayer(){var t=this.options.isVideo,{title:e,elapsedTime:s}=this.options.layout;let i,n;e&&(i=document.createElement("div"),this.addClassName(i,"player-title")),s&&(n=document.createElement("div"),this.addClassName(n,"current-time"));var a=document.createElement("ul"),o=(this.addClassName(a,"playlist"),document.createElement("div")),r=(this.addClassName(o,"transport"),document.createElement("button")),l=(this.addClassName(r,"play-button"),r.innerHTML=c,document.createElement("div")),h=(this.addClassName(l,"progress"),document.createElement("div")),d=(this.addClassName(h,"time-line"),this.components.root);t&&d.appendChild(this.mediaTag),e&&d.appendChild(i),d.appendChild(o),d.appendChild(a),o.appendChild(r),o.appendChild(h),h.appendChild(l),t&&((e=document.createElement("button")).innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M24 9h-2V2h-7V0h9v9zm-9 15v-2h7v-7h2v9h-9zM0 15h2v7h7v2H0v-9zM9 0v2H2v7H0V0h9z"/></svg>',this.addClassName(e,"dmk-video-fullscreen-btn"),o.appendChild(e),this.components.fullscreen=e),s&&o.appendChild(n),this.components.title=i,this.components.playlist=a,this.components.transport={},this.components.transport.main=o,this.components.transport.playButton=r,this.components.transport.progress=l,this.components.transport.timeline=h,this.components.transport.time=n}getFileIndex(t,e){var s=Date.now();return fetch("".concat(e).concat(t,"?v=").concat(s)).then(t=>{if(t.ok)return t.json();throw new Error("Error fetching playlist. Status: "+t.status)})}init(t,e){return this.getFileIndex(t,e).then(t=>{if(this.trackListLength=t.length,0===this.trackListLength)throw new Error("Empty index file");return this.fileIndex=t}).then(t=>{t.forEach((t,e)=>{t={id:t.url,url:t.url,name:t.name,trackNum:e,duration:0},t=this.addItemToPlaylist(t);0===e&&(this.currentTrack=t).element.classList.add("selected")}),this.components.title&&(this.components.title.textContent=this.currentTrack.name),this.audioEvents(),this.uiEvents()}).catch(t=>console.error(t))}sortFiles(t){var e=[];for(const s in t)e.push([s,t[s]]);return e.sort((t,e)=>{t=new Date(t[1].dateModified);return new Date(e[1].dateModified)-t}),e}addItemToPlaylist(t){var e=t["name"];const s=document.createElement("li");this.addClassName(s,"playlist-item");var i=document.createElement("div");return i.textContent=e,s.appendChild(i),s.addEventListener("click",()=>{Array.from(this.components.playlist.children).forEach(t=>{t.classList.remove("selected")}),s.classList.add("selected"),this.togglePlay(t)},!1),t=Object.assign({},t,{element:s}),this.trackList.push(t),this.components.playlist.appendChild(s),t}togglePlay(t){return this.playerCurrentTime=this.mediaTag.currentTime,this.components.title&&(this.components.title.textContent=t.name),this.mediaTag.paused?(t.id!==this.lastId&&(this.playerCurrentTime=void 0),this.play(t)):this.mediaTag.paused||t.id===this.lastId?this.stop():(this.stop(),this.playerCurrentTime=void 0,this.play(t))}play(t){const e=this.components.transport.playButton;var s,i;if(this.fileIndex)return this.currentTrack=t,i=this.trackList[t.trackNum].url,this.mediaTag.src=this.options.rootUrl+i,this.mediaTag.controls=!1,void 0!==this.playerCurrentTime?this.mediaTag.currentTime=this.playerCurrentTime:this.mediaTag.currentTime=0,i=()=>{this.lastId=t.id,this.isPlaying=!0,void 0!==this.callbacks.play&&this.callbacks.play()},(s=this.mediaTag.play())?s.then(i).catch(t=>{console.error(t),e.textContent=":("}):(i(),Promise.resolve());e.textContent=":("}stop(){return this.components.transport.playButton.innerHTML=c,this.mediaTag.pause(),this.isPlaying=!1,void 0!==this.callbacks.stop&&this.callbacks.stop(),Promise.resolve()}onPlayerEnded(){var t,e=this.components.transport.playButton;e.innerHTML=c,this.playerCurrentTime=void 0,this.options.advanceToNextTrack&&(t=this.currentTrack["trackNum"],t<this.trackListLength-1)?(t=this.trackList[t+1],this.currentTrack.element.classList.remove("selected"),t.element.classList.add("selected"),e.innerHTML=n,this.togglePlay(t)):this.mediaTag.currentTime=0}audioEvents(){const t=this.components.transport.playButton,s=this.components.transport.progress;this.mediaTag.addEventListener("play",()=>{t.innerHTML=n},!1),this.mediaTag.addEventListener("pause",()=>{t.innerHTML=c},!1),this.mediaTag.addEventListener("timeupdate",()=>{var t=this.mediaTag.currentTime,e=t/this.mediaTag.duration*100,e=(s.style.width=e+"%",new Date(1e3*t).toISOString().slice(11,19));this.components.transport.time&&(this.components.transport.time.textContent=e)},!1)}uiEvents(){this.components.transport.playButton.addEventListener("click",()=>{this.togglePlay(this.currentTrack)},!1);const s=this.components.transport.timeline,i=this.components.transport.progress;s.addEventListener("click",e=>{var t=()=>{var t=Math.max(0,(e.clientX-s.offsetLeft)/s.offsetWidth);i.style.width=100*t+"%",this.mediaTag.currentTime=t*this.mediaTag.duration};null===this.lastId?this.togglePlay(this.currentTrack).then(t):(t(),this.mediaTag.paused&&this.togglePlay(this.currentTrack))},!1),this.components.fullscreen&&this.components.fullscreen.addEventListener("click",()=>{var t=this.mediaTag;t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()})}};return t.default})());